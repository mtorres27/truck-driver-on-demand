.new-message--wrapper
  .new-message
    - if type == "quote" and quotes.length > 0
      .new-message__options
        - if quotes.first.author_type == "freelancer"
          = f.radio_button :status, "accept"
          = f.label :status_accept, "Accept this quote"
          = f.radio_button :status, "negotiate"
          = f.label :status_negotiate, "Negotiate a better price"
          = f.radio_button :status, "decline"
          = f.label :status_decline, "Decline this quote"
        - elsif quotes.first.author_type == "company" and quotes.first.accepted_by_freelancer == true
          = f.radio_button :status, "accept"
          = f.label :status_accept, "Accept this quote"
        = f.hidden_field :override, value: ""
        
    .new-message__input
      = f.input :body, as: :string, placeholder: "Send a message to #{n.split(" ").first}", label: false
      .new-message__attachment-button onclick="triggerFileUpload()"
        .span class="fa fa-paperclip"
      
    .new-message__counter
      = f.select :counter_type, options: ["fixed", "hourly", "daily"]

    .new-message__counter--fixed
      = f.input :counter, as: :string, placeholder: "Counter offer", label: false

    .new-message__counter--hourly 
      = f.input :counter_hourly_rate, as: :string, placeholder: "Hourly Rate", label: false
      = f.input :counter_number_of_hours, as: :string, placeholder: "Number of Hours", label: false

    .new-message__counter--daily
      = f.input :counter_daily_rate, as: :string, placeholder: "Daily Rate", label: false
      = f.input :counter_number_of_days, as: :string, placeholder: "Number of Days", label: false


    .new-message__submit
      = f.submit "Post Message", class: "btn btn--primary", id: "new-message__submit", onclick: "return validateMessage();"
    .new-message__attachment
      = f.input :attachment, as: :file, label: false
    div#new-message__validation-errors


javascript:
  $(".new-message__counter--hourly").hide();
  $(".new-message__counter--daily").hide();
  $(".new-message__counter--fixed").hide();
  $("#new-message__validation-errors").hide();

  var validateMessage = function() {
    $("#new-message__validation-errors").html("");
    $("#new-message__validation-errors").hide();
    var safe = true;

    if ($("#message_body").val() == "") {
      safe = false;
    }

    if (!safe) {
      $("#new-message__validation-errors").html("A message is required.");
      $("#new-message__validation-errors").show();
    }

    console.log(safe);

    return safe;

  }


  var triggerFileUpload = function () {
    $("#message_attachment").click();
  };

  $("#message_counter_type").on('change', function() {
    $(".new-message__counter--fixed").hide();
    $(".new-message__counter--hourly").hide();
    $(".new-message__counter--daily").hide();

    $(".new-message__counter--"+$("#message_counter_type").val()).show();
  })

  $(".simple_form").on('submit', function(e) {
    if ($("#message_status_accept").is(":checked") && $("input[name='message[override]']").val() != "true") {
      $(".modal__accept-quote").addClass("modal--visible");
      e.preventDefault();
    }

    if ($("#message_status_decline").is(":checked")&& $("input[name='message[override]']").val() != "true") {
      $(".modal__decline-quote").addClass("modal--visible");
      e.preventDefault();
    }
  });


  $("#message_attachment").change(function() {
    $(".new-message__attachment-button").addClass("new-message__attachment-button--active");
  });

  var showCounterOffer = function() {
    var input_ref = $(".new-message__input");
    var counter_ref = $(".new-message__counter");
    if (!input_ref.hasClass("new-message__input--counter-visible")) {
      input_ref.addClass("new-message__input--counter-visible");
      counter_ref.addClass("new-message__counter--visible");
    };

    $(".new-message__counter--fixed").show();
    $(".new-message__counter--hourly").hide();
    $(".new-message__counter--daily").hide();
  }

  var hideCounterOffer = function() {
    var input_ref = $(".new-message__input");
    var counter_ref = $(".new-message__counter");
    if (input_ref.hasClass("new-message__input--counter-visible")) {
      input_ref.removeClass("new-message__input--counter-visible");
      counter_ref.removeClass("new-message__counter--visible");
    };

    $(".new-message__counter--fixed").hide();
    $(".new-message__counter--hourly").hide();
    $(".new-message__counter--daily").hide();
  }

  var makeRadiosDeselectableByName = function(name){
    $('#' + name).click(function() {
        if($(this).attr('previousValue') == 'true'){
            $(this).attr('checked', false)
        } else {
            $('#' + name).attr('previousValue', false);
        }

        if ($(this).is(':checked')) {
          if ($(this).attr("id").indexOf("_negotiate", 0) > 0) {
            showCounterOffer();
          } else {
            hideCounterOffer();
          }
        } else {
          hideCounterOffer();
        }

        $(this).attr('previousValue', $(this).is(':checked'));
    });
  };

  makeRadiosDeselectableByName("message_status_accept");
  makeRadiosDeselectableByName("message_status_decline");
  makeRadiosDeselectableByName("message_status_negotiate");

